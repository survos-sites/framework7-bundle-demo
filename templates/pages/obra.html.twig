
{#@todo: title icon?#}
<twig:SurvosFw:Framework7Page :caller="_self"
             :title="'obra'|trans"
>
  <twig:block name="title">
    @@title@@
  </twig:block>
  <twig:block name="content">
    {% set store = 'obras' %}
    {% set globals = {
      locale: app.locale

    } %}



    {% set queries = {
      obra: {store: 'obras', type: 'find' , id : '{{event.details.id}}' , templateName: 'obra'}
    }%}
    <twig:dexie
            refreshEvent="obra.refresh"
            :store="store"
            :queries="queries"
            :globals="globals"
            :caller="_self">


       <twig:block name="obra" id="twig_obra_template">
       {% set locale = globals.locale %}
         {% set audioUrl = (data.audioUrl ?? (data.audio and data.audio.resized and data.audio.resized.large ? data.audio.resized.large : null)) %}
         {% set youtubeUrl = data.youtubeUrl ?? null %}

        <!-- Main Obra Card -->
        <div class="card" style="margin: 0;">
          <!-- Card Header with Title -->
          <div class="card-header">
            <div class="card-header-inner">
              <h1 class="card-title">{{ data.title }}</h1>
              <h2 class="card-subtitle">{{ data.artistName|title }}</h2>
            </div>
          </div>

          <!-- Card Content -->
          <div class="card-content card-content-padding">

            <!-- Artwork Image -->

            <!-- Artwork Image + Big Overlay Play -->
            {% set heroSrc = null %}
            {% if data.images is defined and data.images[0] is defined and data.images[0].resized is defined and data.images[0].resized.large is defined %}
              {% set heroSrc = data.images[0].resized.large %}
            {% elseif data.thumbnailUrl is defined %}
              {% set heroSrc = data.thumbnailUrl %}
            {% endif %}

            {% if heroSrc %}
              <div class="obra-image-container" style="position:relative; text-align:center; margin-bottom:16px;">
                <img src="{{ heroSrc }}" alt="{{ data.title|e }}"
                     style="max-width:100%; height:auto; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.15);">
                {% if audioUrl %}
                  <!-- Big center Play/Pause button -->
                  <button type="button"
                          id="obra-hero-toggle"
                          class="button button-large button-fill"
                          style="position:absolute; left:50%; top:50%; transform:translate(-50%, -50%);
                     border-radius:9999px; padding:18px 22px; line-height:1; box-shadow:0 6px 16px rgba(0,0,0,.25);">
                    <i class="f7-icons" id="obra-hero-icon">play_fill</i>
                  </button>
                {% endif %}
              </div>
            {% endif %}



{#            {% if data.images is defined and data.images[0] is defined and data.images[0].resized is defined and data.images[0].resized.large is defined %}#}
{#              <div class="obra-image-container" style="text-align: center; margin-bottom: 16px;">#}
{#                <img src="{{ data.images[0].resized.large }}" alt="{{ data.title|e }}"#}
{#                     style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">#}
{#              </div>#}
{#            {% elseif data.thumbnailUrl is defined %}#}
{#              <div class="obra-image-container" style="text-align: center; margin-bottom: 16px;">#}
{#                <img src="{{ data.thumbnailUrl }}" alt="{{ data.title|e }}"#}
{#                     style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">#}
{#              </div>#}
{#            {% endif %}#}

            <!-- Details List -->
            <div class="list list-strong list-dividers list-outline">
              <ul>
                <!-- Materials -->
                {% if data.materials %}
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title">Materiales</div>
                        <div class="item-after">{{ data.materials }}</div>
                      </div>
                    </div>
                  </li>
                {% endif %}

                <!-- Location -->
                {% if data.location %}
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title">Ubicación</div>
                        <div class="item-after">
                          {% if data.location.name %}
                            {{ data.location.name }}
                          {% else %}
                            {{ data.location.code }}
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </li>
                {% endif %}

                <!-- Dimensions -->
                {% if data.size %}
                  <li>
                    <div class="item-content">
                      <div class="item-inner">
                        <div class="item-title">Dimensiones</div>
                        <div class="item-after">{{ data.size }}</div>
                      </div>
                    </div>
                  </li>
                {% endif %}
              </ul>
            </div>

            {% set description = data.content[locale] %}
            {% if description %}
              <div class="block block-strong">
                <h4>Descripción</h4>
                <p>{{ description }}</p>
              </div>
            {% endif %}

            <!-- Image Gallery -->
            {% if data.images is defined and data.images|length > 1 %}
              <div class="block block-strong">
                <h4>Galería de Imágenes</h4>
                <div class="row" style="gap: 8px;">
                  {% for image in data.images %}
                    {% if image.resized is defined and image.resized.medium is defined %}
                      <div class="col-50" style="margin-bottom: 8px;">
                        <img src="{{ image.resized.medium }}" alt="{{ data.title|e }}"
                             style="width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer;"
                             onclick="app.photoBrowser.create({photos: [{{ image.resized.large ? '\'' ~ image.resized.large ~ '\'' : '\'' ~ image.resized.medium ~ '\'' }}], theme: 'dark'}).open();">
                      </div>
                    {% endif %}
                  {% endfor %}
                </div>
              </div>
            {% endif %}
          </div>

          <!-- Audio Card (if available) -->
          {% if data.audio is defined and data.audio.resized is defined and data.audio.resized.large is defined %}
            <div class="card-footer">
              <div class="audio-container">
                <audio controls style="width: 100%; margin-top: 8px;" src="{{ data.audio.resized.large|e }}">
                  Your browser does not support the audio element.
                </audio>
              </div>
            </div>
          {% endif %}
        </div>

        <!-- YouTube Video Card (if available) -->
        {% if data.youtubeUrl %}
          <div class="card" style="margin: 0; margin-top: 16px;">
            <div class="card-header">
              <div class="card-header-inner">
                <h3 class="card-title">
                  Video
                </h3>
              </div>
            </div>
            <div class="card-content card-content-padding">
              <div class="video-container">
                <iframe
                        width="100%"
                        height="200"
                        src="{{ data.youtubeUrl }}"
                        title="YouTube"
                        frameborder="0"
                        style="border-radius: 8px;"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                </iframe>
              </div>
            </div>
          </div>
        {% endif %}
        <!-- twig_obra_template -->
      </twig:block>




      <twig:block name="title" id="title_template">
        <sup>
          {{ data.code }}
        </sup>
        {% set locale = globals.locale %}
        {{ data.title|title }}
        <!-- title_template -->
      </twig:block>


      <twig:block name="twig_template" id="hack_to_get_raw_data">
        {% set locale = globals.locale %}
        <div class="artist-detail">
          <h1>{{ data.artistName|title }}</h1>
          {% set description = data.content[locale] %}
          <article>
            <p>
              <p>{{ data.bio }}</p>
              <p>{{ data.slogan }}</p>
            </p>
            <div>
              <p>Birth Year: {{ data.birthYear }}</p>
              <p>Email: {{ data.email }}</p>
              <p>Code: {{ data.code }}</p>
            </div>
            <p>
            {% for i in 1..3 %}
              <img style="max-width: 120px"
                      src="https://elmodo.mx/wp-content/uploads/2025/03/LRdJ_CarruselWeb_{{ i }}.jpg" />
            {% endfor %}
        </p>
          </article>
        </div>
        <!-- hack_to_get_raw_data -->
      </twig:block>
    </twig:dexie>
  </twig:block>
</twig:SurvosFw:Framework7Page>
